<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beachfeld Aussetzer-Tracker</title>
    <!-- Um m√∂gliche Pfadprobleme bei GitHub Pages zu beheben -->
    <base href="/Beachfeld/">
    <style>
        /* CSS-STILE F√úR OPTIK UND RESPONSIVENESS */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f7f6;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }
        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
        }

        /* --- Login-Bereich --- */
        #login-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 20px;
            border: 1px dashed #bdc3c7;
            border-radius: 8px;
            text-align: center;
        }
        select, button {
            padding: 12px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
        }
        select {
            border: 1px solid #ccc;
            background-color: #f9f9f9;
        }
        .login-btn {
            background-color: #3498db;
            color: white;
            border: none;
        }
        .login-btn:hover {
            background-color: #2980b9;
            transform: translateY(-1px);
        }
        #login-message {
            color: #e74c3c;
            font-weight: bold;
            display: none;
        }
        
        /* --- App-Bereich --- */
        #app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #ecf0f1;
            padding-bottom: 15px;
        }
        .logout-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
        }
        .logout-btn:hover {
            background-color: #c0392b;
        }

        /* --- Tabelle --- */
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 10px;
            margin-top: 10px;
        }
        th, td {
            text-align: left;
            padding: 15px;
        }
        th {
            background-color: #f1f1f1;
            color: #555;
            cursor: pointer;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        tr {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        tr:nth-child(odd) {
            background-color: #fcfcfc;
        }
        .increase-btn {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 10px 18px;
        }
        .increase-btn:hover {
            background-color: #27ae60;
        }
        
        /* --- Nachrichtenbereich --- */
        .message {
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 6px;
            font-weight: bold;
            display: none;
            text-align: center;
        }
        .message.error {
            background-color: #f9e3e3;
            color: #c0392b;
            border: 1px solid #c0392b;
        }
        .message.success {
            background-color: #e3f9e3;
            color: #27ae60;
            border: 1px solid #27ae60;
        }

        /* Responsive Anpassungen */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 20px 15px;
            }
            #app-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            th, td {
                padding: 10px;
                font-size: 14px;
            }
            table, thead, tbody, th, td, tr { 
                display: block; 
            }
            thead tr { 
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            tr {
                border: 1px solid #ccc;
                margin-bottom: 20px;
                padding: 10px 0;
            }
            td {
                border: none;
                border-bottom: 1px solid #eee;
                position: relative;
                padding-left: 50%;
                text-align: right;
            }
            td:before {
                position: absolute;
                top: 50%;
                left: 6px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                content: attr(data-label);
                font-weight: bold;
                text-align: left;
                transform: translateY(-50%);
            }
            td:nth-of-type(1):before { content: "Name:"; }
            td:nth-of-type(2):before { content: "Aussetzer:"; }
            td:nth-of-type(3):before { content: "Aktion:"; }
            .increase-btn {
                width: 100%;
                margin-top: 5px;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Beachfeld Aussetzer-Tracker üèê</h1>

    <!-- Meldungsbereich -->
    <div id="message-area" class="message error"></div>

    <!-- 1. LOGIN-BEREICH -->
    <section id="login-section">
        <h2>Anmelden</h2>
        <div id="login-message"></div>
        <select id="name-select">
            <option value="">-- W√§hle deinen Namen --</option>
            <option value="Sandro">Sandro</option>
            <option value="Norman">Norman</option>
            <option value="Florian">Florian</option>
            <option value="Felix">Felix</option>
            <option value="Elias">Elias</option>
        </select>
        <button class="login-btn" onclick="login()">Anmelden</button>
    </section>

    <!-- 2. ANWENDUNGS-BEREICH (wird nach Login sichtbar) -->
    <section id="app-section" style="display:none;">
        <div id="app-header">
            <div>
                Eingeloggt als: <strong id="current-user-display"></strong>
            </div>
            <button class="logout-btn" onclick="logout()">Abmelden</button>
        </div>

        <table>
            <thead>
                <tr>
                    <th onclick="sortTable(0)">Name ‚Üï</th>
                    <th onclick="sortTable(1)">Aussetzer ‚Üï</th>
                    <th>Aktion</th>
                </tr>
            </thead>
            <tbody id="score-table-body">
                <!-- Tabelle wird durch JavaScript gef√ºllt -->
            </tbody>
        </table>
    </section>
</div>

<!-- JAVASCRIPT LOGIK -->
<script>
    // --- Konfiguration und Initialisierung ---
    const USERS = ["Sandro", "Norman", "Florian", "Felix", "Elias"]; 
    const INITIAL_SCORES = USERS.reduce((acc, name) => {
        acc[name] = 0;
        return acc;
    }, {});
    
    // Key f√ºr LocalStorage 
    const STORAGE_KEY_USER = 'aussetzer_tracker_user';
    const STORAGE_KEY_SCORES = 'aussetzer_tracker_scores';
    const STORAGE_KEY_LAST_UPDATE = 'aussetzer_tracker_last_update';
    
    let currentUser = null;
    let currentSortColumn = 1; 
    let currentSortDirection = 'desc'; 

    // --- LocalStorage Funktionen ---
    
    function getScores() {
        const storedScores = localStorage.getItem(STORAGE_KEY_SCORES);
        if (storedScores) {
            return JSON.parse(storedScores);
        }
        return INITIAL_SCORES;
    }

    function saveScores(scores) {
        localStorage.setItem(STORAGE_KEY_SCORES, JSON.stringify(scores));
    }

    function getLastUpdateTimes() {
        const storedTimes = localStorage.getItem(STORAGE_KEY_LAST_UPDATE);
        return storedTimes ? JSON.parse(storedTimes) : {};
    }

    function saveLastUpdateTimes(times) {
        localStorage.setItem(STORAGE_KEY_LAST_UPDATE, JSON.stringify(times));
    }

    // --- Anmelde- und UI-Funktionen ---
    
    function saveCurrentUser(name) {
        localStorage.setItem(STORAGE_KEY_USER, name);
    }
    
    function deleteCurrentUser() {
        localStorage.removeItem(STORAGE_KEY_USER);
    }

    function checkLogin() {
        const storedUser = localStorage.getItem(STORAGE_KEY_USER); 
        
        // Pr√ºfen, ob ein g√ºltiger Benutzer gespeichert wurde
        if (storedUser && USERS.includes(storedUser)) {
            currentUser = storedUser;
            document.getElementById('current-user-display').textContent = currentUser;
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('app-section').style.display = 'block';
            renderTable();
        } else {
            currentUser = null;
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('app-section').style.display = 'none';
        }
        hideMessage();
    }

    function login() {
        const selectedName = document.getElementById('name-select').value;
        const loginMessage = document.getElementById('login-message');
        
        if (!selectedName) {
            loginMessage.textContent = 'Bitte w√§hle deinen Namen aus!';
            loginMessage.style.display = 'block';
            return;
        }

        // Speichere den ausgew√§hlten Namen f√ºr den automatischen Login
        saveCurrentUser(selectedName);
        checkLogin();
    }

    function logout() {
        // Beim Abmelden den gespeicherten Benutzer l√∂schen
        deleteCurrentUser();
        checkLogin();
    }

    function showMessage(text, type = 'error') {
        const messageArea = document.getElementById('message-area');
        messageArea.textContent = text;
        messageArea.className = `message ${type}`;
        messageArea.style.display = 'block';
        
        // Nachricht nach 5 Sekunden ausblenden
        setTimeout(hideMessage, 5000);
    }

    function hideMessage() {
        document.getElementById('message-area').style.display = 'none';
        document.getElementById('login-message').style.display = 'none';
    }

    // --- Counter-Logik (mit Best√§tigungs-Dialog) ---
    
    function increaseCounter(name) {
        if (!currentUser || name !== currentUser) {
            // Sollte durch die UI verhindert werden, aber als zus√§tzliche Sicherheit
            showMessage('Fehler: Du darfst nur deinen eigenen Counter erh√∂hen!', 'error');
            return;
        }

        // NEUE ANPASSUNG: Best√§tigungsabfrage
        const confirmation = confirm("Sicher, dass du den Counter erh√∂hen willst? Dies kann nicht r√ºckg√§ngig gemacht werden!");
        
        if (!confirmation) {
            showMessage('Vorgang abgebrochen.', 'error');
            return; 
        }

        // --- 24h-Sperr-Logik ---
        const now = new Date().getTime();
        const lastUpdateTimes = getLastUpdateTimes();
        const lastTime = lastUpdateTimes[name] || 0;
        const timeDiff = now - lastTime;
        const TWENTY_FOUR_HOURS_MS = 24 * 60 * 60 * 1000;

        if (timeDiff < TWENTY_FOUR_HOURS_MS) {
            showMessage("Hey, hier wird nicht gecheated! Du kannst den Counter nur einmal pro 24 Stunden erh√∂hen.", 'error');
            return;
        }

        // Counter erh√∂hen und speichern
        const scores = getScores();
        scores[name] = (scores[name] || 0) + 1;
        saveScores(scores);

        // Letzte Updatezeit speichern
        lastUpdateTimes[name] = now;
        saveLastUpdateTimes(lastUpdateTimes);

        showMessage(`${name} hat seinen Aussetzer-Counter auf ${scores[name]} erh√∂ht.`, 'success');
        renderTable();
    }

    // --- Tabellen-Logik ---

    function renderTable() {
        const scores = getScores();
        const tableBody = document.getElementById('score-table-body');
        tableBody.innerHTML = '';
        
        // Daten f√ºr Sortierung vorbereiten
        let data = Object.entries(scores).map(([name, score]) => [name, score]);

        // Sortierung anwenden
        data.sort((a, b) => {
            const valA = a[currentSortColumn];
            const valB = b[currentSortColumn];

            let comparison = 0;
            if (currentSortColumn === 0) { // Nach Name sortieren (String)
                comparison = valA.localeCompare(valB);
            } else { // Nach Score sortieren (Zahl)
                comparison = valA - valB;
            }

            return currentSortDirection === 'asc' ? comparison : comparison * -1;
        });

        // Tabelle f√ºllen
        data.forEach(([name, score]) => {
            const row = tableBody.insertRow();
            
            // Zelle 1: Name
            const cellName = row.insertCell();
            cellName.textContent = name;
            cellName.setAttribute('data-label', 'Name:');
            
            // Zelle 2: Aussetzer
            const cellScore = row.insertCell();
            cellScore.innerHTML = `Hat <strong>${score}</strong> mal ausgesetzt`;
            cellScore.setAttribute('data-label', 'Aussetzer:');
            
            // Zelle 3: Aktion
            const cellAction = row.insertCell();
            cellAction.setAttribute('data-label', 'Aktion:');
            
            const button = document.createElement('button');
            button.className = 'increase-btn';
            button.textContent = `+1 f√ºr ${name}`;
            button.onclick = () => increaseCounter(name);
            
            // Button nur f√ºr den eingeloggten Benutzer anzeigen und aktivieren
            if (currentUser === name) {
                cellAction.appendChild(button);
            } else {
                cellAction.innerHTML = '<span style="color: #95a5a6; font-size: 12px;">Nur eigener Counter</span>';
            }
        });
    }
    
    function sortTable(columnIndex) {
        // Setze Sortierpfeile zur√ºck
        document.querySelectorAll('th').forEach(th => th.classList.remove('sorted-asc', 'sorted-desc'));

        if (columnIndex === currentSortColumn) {
            currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
        } else {
            currentSortColumn = columnIndex;
            currentSortDirection = columnIndex === 0 ? 'asc' : 'desc';
        }
        
        // Markiere die aktuelle Sortierspalte
        const currentHeader = document.querySelectorAll('th')[columnIndex];
        currentHeader.classList.add(`sorted-${currentSortDirection}`);
        
        renderTable();
    }

    // --- Start der Anwendung ---
    window.onload = checkLogin;
</script>

</body>
</html>
